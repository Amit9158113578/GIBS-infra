input {
  file {
    path => "/etc/logstash/files/vaccination/master_data/health_facilities/*.csv"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    stat_interval =>  "1 minute"
  }
}

filter {
    csv {
      separator => ","
      autodetect_column_names => true
      skip_empty_columns => true
      skip_empty_rows => true
	  }

    mutate {
      remove_field => ["message"]
    }
	
}

output {
	stdout {codec => rubydebug}

  if ![tags] {           # Health Facilities
    elasticsearch {
      id => "output.master-data.health_facilities"
      hosts => ["$elasticsearch_hosts"]
      cacert => "/etc/logstash/security/ca/ca.crt"
      user => "$elasticsearch_username"
      password => "$elasticsearch_password"
      ssl => true
      ssl_certificate_verification => true
      index => "rbc.covid19-vaccination.master-data.health_facilities"
      document_id => "%{Facility Code}"
    } 
  } else {
    elasticsearch {               # Errors
      id => "output.master-data.error"
      hosts => ["$elasticsearch_hosts"]
      cacert => "/etc/logstash/security/ca/ca.crt"
      user => "$elasticsearch_username"
      password => "$elasticsearch_password"
      ssl => true
      ssl_certificate_verification => true
      index => "rbc.covid19-vaccination.master-data.error"
    }
  }
}

